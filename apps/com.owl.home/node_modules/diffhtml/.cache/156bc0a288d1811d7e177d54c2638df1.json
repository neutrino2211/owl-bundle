{"id":"w5jU","dependencies":[{"name":"/home/tbranyen/git/diffhtml/packages/diffhtml/package.json","includedInParent":true,"mtime":1534977442154},{"name":"/home/tbranyen/git/diffhtml/packages/diffhtml/.babelrc","includedInParent":true,"mtime":1534634600429},{"name":"../transaction","loc":{"line":1,"column":24},"parent":"/home/tbranyen/git/diffhtml/packages/diffhtml/lib/tasks/schedule.js","resolved":"/home/tbranyen/git/diffhtml/packages/diffhtml/lib/transaction.js"},{"name":"../util/caches","loc":{"line":2,"column":27},"parent":"/home/tbranyen/git/diffhtml/packages/diffhtml/lib/tasks/schedule.js","resolved":"/home/tbranyen/git/diffhtml/packages/diffhtml/lib/util/caches.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.default=a;var e=require(\"../transaction\"),r=n(e),t=require(\"../util/caches\");function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=e.state,n=t.isRendering,a=t.activeTransaction,i=t.nextTransaction;if(n){var s=e.tasks,o=i||a;t.nextTransaction=e,e.abort();var u=o.promise||Promise.resolve();return e.promise=u.then(function(){return e.aborted=!1,r.default.flow(e,s.slice(1))})}t.isRendering=!0,t.activeTransaction=e}","map":{"mappings":[{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":0}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":13}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":20}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":35}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":43}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":56}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":57}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":64}},{"source":"tasks/schedule.js","name":"schedule","original":{"line":13,"column":24},"generated":{"line":1,"column":68}},{"source":"tasks/schedule.js","name":"schedule","original":{"line":13,"column":24},"generated":{"line":1,"column":76}},{"source":"tasks/schedule.js","name":"schedule","original":{"line":13,"column":24},"generated":{"line":1,"column":84}},{"source":"tasks/schedule.js","original":{"line":1,"column":0},"generated":{"line":1,"column":86}},{"source":"tasks/schedule.js","original":{"line":1,"column":0},"generated":{"line":1,"column":90}},{"source":"tasks/schedule.js","original":{"line":1,"column":0},"generated":{"line":1,"column":92}},{"source":"tasks/schedule.js","original":{"line":1,"column":0},"generated":{"line":1,"column":100}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":118}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":120}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":122}},{"source":"tasks/schedule.js","original":{"line":2,"column":0},"generated":{"line":1,"column":125}},{"source":"tasks/schedule.js","original":{"line":2,"column":0},"generated":{"line":1,"column":127}},{"source":"tasks/schedule.js","original":{"line":2,"column":0},"generated":{"line":1,"column":135}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":153}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":162}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":164}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":167}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":174}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":177}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":179}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":190}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":192}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":193}},{"source":"tasks/schedule.js","original":{"line":42,"column":1},"generated":{"line":1,"column":201}},{"source":"tasks/schedule.js","original":{"line":13,"column":15},"generated":{"line":1,"column":204}},{"source":"tasks/schedule.js","name":"schedule","original":{"line":13,"column":24},"generated":{"line":1,"column":213}},{"source":"tasks/schedule.js","name":"transaction","original":{"line":13,"column":33},"generated":{"line":1,"column":215}},{"source":"tasks/schedule.js","name":"state","original":{"line":15,"column":8},"generated":{"line":1,"column":218}},{"source":"tasks/schedule.js","name":"state","original":{"line":15,"column":8},"generated":{"line":1,"column":222}},{"source":"tasks/schedule.js","name":"transaction","original":{"line":15,"column":18},"generated":{"line":1,"column":224}},{"source":"tasks/schedule.js","name":"state","original":{"line":15,"column":8},"generated":{"line":1,"column":226}},{"source":"tasks/schedule.js","name":"isRendering","original":{"line":17,"column":10},"generated":{"line":1,"column":232}},{"source":"tasks/schedule.js","name":"state","original":{"line":17,"column":62},"generated":{"line":1,"column":234}},{"source":"tasks/schedule.js","name":"isRendering","original":{"line":17,"column":10},"generated":{"line":1,"column":236}},{"source":"tasks/schedule.js","name":"activeTransaction","original":{"line":17,"column":23},"generated":{"line":1,"column":248}},{"source":"tasks/schedule.js","name":"state","original":{"line":17,"column":62},"generated":{"line":1,"column":250}},{"source":"tasks/schedule.js","name":"activeTransaction","original":{"line":17,"column":23},"generated":{"line":1,"column":252}},{"source":"tasks/schedule.js","name":"nextTransaction","original":{"line":17,"column":42},"generated":{"line":1,"column":270}},{"source":"tasks/schedule.js","name":"state","original":{"line":17,"column":62},"generated":{"line":1,"column":272}},{"source":"tasks/schedule.js","name":"nextTransaction","original":{"line":17,"column":42},"generated":{"line":1,"column":274}},{"source":"tasks/schedule.js","name":"isRendering","original":{"line":21,"column":6},"generated":{"line":1,"column":290}},{"source":"tasks/schedule.js","name":"isRendering","original":{"line":21,"column":6},"generated":{"line":1,"column":293}},{"source":"tasks/schedule.js","original":{"line":21,"column":19},"generated":{"line":1,"column":295}},{"source":"tasks/schedule.js","name":"tasks","original":{"line":22,"column":12},"generated":{"line":1,"column":296}},{"source":"tasks/schedule.js","name":"tasks","original":{"line":22,"column":12},"generated":{"line":1,"column":300}},{"source":"tasks/schedule.js","name":"transaction","original":{"line":22,"column":22},"generated":{"line":1,"column":302}},{"source":"tasks/schedule.js","name":"tasks","original":{"line":22,"column":12},"generated":{"line":1,"column":304}},{"source":"tasks/schedule.js","name":"chainTransaction","original":{"line":23,"column":10},"generated":{"line":1,"column":310}},{"source":"tasks/schedule.js","name":"nextTransaction","original":{"line":23,"column":29},"generated":{"line":1,"column":312}},{"source":"tasks/schedule.js","name":"activeTransaction","original":{"line":23,"column":48},"generated":{"line":1,"column":315}},{"source":"tasks/schedule.js","name":"nextTransaction","original":{"line":26,"column":10},"generated":{"line":1,"column":317}},{"source":"tasks/schedule.js","name":"nextTransaction","original":{"line":26,"column":10},"generated":{"line":1,"column":319}},{"source":"tasks/schedule.js","name":"transaction","original":{"line":26,"column":28},"generated":{"line":1,"column":335}},{"source":"tasks/schedule.js","name":"abort","original":{"line":29,"column":16},"generated":{"line":1,"column":337}},{"source":"tasks/schedule.js","name":"abort","original":{"line":29,"column":16},"generated":{"line":1,"column":339}},{"source":"tasks/schedule.js","name":"promise","original":{"line":31,"column":10},"generated":{"line":1,"column":347}},{"source":"tasks/schedule.js","name":"promise","original":{"line":31,"column":10},"generated":{"line":1,"column":351}},{"source":"tasks/schedule.js","name":"chainTransaction","original":{"line":31,"column":20},"generated":{"line":1,"column":353}},{"source":"tasks/schedule.js","name":"promise","original":{"line":31,"column":37},"generated":{"line":1,"column":355}},{"source":"tasks/schedule.js","name":"Promise","original":{"line":31,"column":48},"generated":{"line":1,"column":364}},{"source":"tasks/schedule.js","name":"resolve","original":{"line":31,"column":56},"generated":{"line":1,"column":372}},{"source":"tasks/schedule.js","name":"transaction","original":{"line":33,"column":11},"generated":{"line":1,"column":382}},{"source":"tasks/schedule.js","name":"transaction","original":{"line":33,"column":11},"generated":{"line":1,"column":389}},{"source":"tasks/schedule.js","name":"promise","original":{"line":33,"column":23},"generated":{"line":1,"column":391}},{"source":"tasks/schedule.js","name":"promise","original":{"line":33,"column":33},"generated":{"line":1,"column":399}},{"source":"tasks/schedule.js","name":"then","original":{"line":33,"column":41},"generated":{"line":1,"column":401}},{"source":"tasks/schedule.js","original":{"line":33,"column":46},"generated":{"line":1,"column":406}},{"source":"tasks/schedule.js","name":"Transaction","original":{"line":35,"column":13},"generated":{"line":1,"column":417}},{"source":"tasks/schedule.js","name":"aborted","original":{"line":34,"column":18},"generated":{"line":1,"column":424}},{"source":"tasks/schedule.js","name":"aborted","original":{"line":34,"column":18},"generated":{"line":1,"column":426}},{"source":"tasks/schedule.js","original":{"line":34,"column":28},"generated":{"line":1,"column":435}},{"source":"tasks/schedule.js","name":"Transaction","original":{"line":35,"column":13},"generated":{"line":1,"column":437}},{"source":"tasks/schedule.js","name":"flow","original":{"line":35,"column":25},"generated":{"line":1,"column":439}},{"source":"tasks/schedule.js","name":"flow","original":{"line":35,"column":25},"generated":{"line":1,"column":447}},{"source":"tasks/schedule.js","name":"transaction","original":{"line":35,"column":30},"generated":{"line":1,"column":452}},{"source":"tasks/schedule.js","name":"tasks","original":{"line":35,"column":43},"generated":{"line":1,"column":454}},{"source":"tasks/schedule.js","name":"slice","original":{"line":35,"column":49},"generated":{"line":1,"column":456}},{"source":"tasks/schedule.js","original":{"line":35,"column":55},"generated":{"line":1,"column":462}},{"source":"tasks/schedule.js","name":"isRendering","original":{"line":40,"column":8},"generated":{"line":1,"column":468}},{"source":"tasks/schedule.js","name":"isRendering","original":{"line":40,"column":8},"generated":{"line":1,"column":470}},{"source":"tasks/schedule.js","original":{"line":40,"column":22},"generated":{"line":1,"column":483}},{"source":"tasks/schedule.js","name":"activeTransaction","original":{"line":41,"column":8},"generated":{"line":1,"column":485}},{"source":"tasks/schedule.js","name":"activeTransaction","original":{"line":41,"column":8},"generated":{"line":1,"column":487}},{"source":"tasks/schedule.js","name":"transaction","original":{"line":41,"column":28},"generated":{"line":1,"column":505}}],"sources":{"tasks/schedule.js":"import Transaction from '../transaction';\nimport { StateCache } from '../util/caches';\n\n/**\n * If diffHTML is rendering anywhere asynchronously, we need to wait until it\n * completes before this render can be executed. This sets up the next\n * buffer, if necessary, which serves as a Boolean determination later to\n * `bufferSet`.\n *\n * @param {Object} nextTransaction - The Transaction instance to schedule\n * @return {Boolean} - Value used to terminate a transaction render flow\n */\nexport default function schedule(transaction) {\n  // The state is a global store which is shared by all like-transactions.\n  let { state } = transaction;\n\n  const { isRendering, activeTransaction, nextTransaction } = state;\n\n  // If there is an in-flight transaction render happening, push this\n  // transaction into a queue.\n  if (isRendering) {\n    const { tasks } = transaction;\n    const chainTransaction = nextTransaction || activeTransaction;\n\n    // Pave over the `nextTransaction` to chain off the previous.\n    state.nextTransaction = transaction;\n\n    // Abort the remaining tasks (but do not signal completion).\n    transaction.abort();\n\n    const promise = chainTransaction.promise || Promise.resolve();\n\n    return transaction.promise = promise.then(() => {\n      transaction.aborted = false;\n      return Transaction.flow(transaction, tasks.slice(1));\n    });\n  }\n\n  // Indicate we are now rendering a transaction for this DOM Node.\n  state.isRendering = true;\n  state.activeTransaction = transaction;\n}\n"},"lineCount":null}},"hash":"991855ca453d50e838d726528269b357","cacheData":{"env":{}}}
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.diff=e.diff||{})}(this,function(e){"use strict";var a=new Map,Q=new Map,W=new Map,d=new Set;d.CreateTreeHookCache=new Set,d.CreateNodeHookCache=new Set,d.SyncTreeHookCache=new Set,d.ReleaseHookCache=new Set;for(var t=Object.freeze({StateCache:a,NodeCache:Q,TransitionCache:W,MiddlewareCache:d}),r=new Set,o=new Set,n=new Set,i={free:r,allocated:o,protected:n},s=0;s<1e4;s++)r.add({rawNodeName:"",nodeName:"",nodeValue:"",nodeType:1,key:"",childNodes:[],attributes:{}});var l=r.values(),O={size:1e4,memory:i,get:function(){var e=l.next(),t=e.value,n=void 0===t?{rawNodeName:"",nodeName:"",nodeValue:"",nodeType:1,key:"",childNodes:[],attributes:{}}:t;return e.done&&(l=r.values()),r.delete(n),o.add(n),n},protect:function(e){o.delete(e),n.add(e)},unprotect:function(e){n.has(e)&&(n.delete(e),r.add(e))}},X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),Y=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},V=d.CreateTreeHookCache,L=Array.isArray,M="#document-fragment";function _(e,t,n){for(var r=arguments.length,o=Array(3<r?r-3:0),a=3;a<r;a++)o[a-3]=arguments[a];if(!e)return null;if(L(e)){n=[];for(var i=0;i<e.length;i++){var d=_(e[i]);if(d){var s,l=11===d.nodeType;if("string"==typeof d.rawNodeName&&l)(s=n).push.apply(s,Y(d.childNodes));else n.push(d)}}return _(M,null,n)}var u="object"===(void 0===e?"undefined":X(e));if(e&&u&&"parentNode"in e){if(t={},n=[],3===e.nodeType)n=e.nodeValue;else if(1===e.nodeType&&e.attributes.length){t={};for(var c=0;c<e.attributes.length;c++){var f=e.attributes[c],h=f.name,p=f.value;""===p&&h in e?t[h]=e[h]:t[h]=p}}if((1===e.nodeType||11===e.nodeType)&&e.childNodes.length){n=[];for(var v=0;v<e.childNodes.length;v++)n.push(_(e.childNodes[v]))}var g=_(e.nodeName,t,n);return Q.set(g,e),g}if(u)return!("children"in e)||"childNodes"in e?e:_(e.nodeName||e.elementName,e.attributes,e.children);o.length&&(n=[n].concat(o));var m=O.get(),T="#text"===e,y="string"==typeof e;if(m.key="",m.rawNodeName=e,m.nodeName=y?e.toLowerCase():"#document-fragment",m.childNodes.length=0,m.nodeValue="",m.attributes={},T){var N=2===arguments.length?t:n,E=L(N)?N.join(""):N;return m.nodeType=3,m.nodeValue=String(E||""),m}m.nodeType=e===M||"string"!=typeof e?11:"#comment"===e?8:1;var b=L(t)||"object"!==(void 0===t?"undefined":X(t))?t:n,w=L(b)?b:[b];if(b&&w.length)for(var k=0;k<w.length;k++){var C=w[k];if(L(C))for(var S=0;S<C.length;S++)m.childNodes.push(C[S]);else{if(!C)continue;if(11===C.nodeType&&"string"==typeof C.rawNodeName)for(var R=0;R<C.childNodes.length;R++)m.childNodes.push(C.childNodes[R]);else C&&"object"===(void 0===C?"undefined":X(C))?m.childNodes.push(C):C&&m.childNodes.push(_("#text",null,C))}}t&&"object"===(void 0===t?"undefined":X(t))&&!L(t)&&(m.attributes=t),"script"===m.nodeName&&m.attributes.src&&(m.key=String(m.attributes.src)),m.attributes&&"key"in m.attributes&&(m.key=String(m.attributes.key));var H=m;return V.forEach(function(e,t){(t=e(H))&&(H=t)}),H}var c="undefined"!=typeof process?process:{env:{NODE_ENV:"development"}},f=d.CreateNodeHookCache,h="http://www.w3.org/2000/svg";function Z(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document,t=arguments[2],r=Q.get(n);if(r){if(r.nodeName.toLowerCase()!==n.nodeName)throw new Error("Shit is wrong");return r}var o=n.nodeName,a=n.rawNodeName,i=void 0===a?o:a,d=n.childNodes,s=void 0===d?[]:d;t=t||"svg"===o;var l=null;f.forEach(function(e,t){(t=e(n))&&(l=t)}),l||(l="#text"===o?e.createTextNode(n.nodeValue):"#document-fragment"===o?e.createDocumentFragment():t?e.createElementNS(h,i):e.createElement(i)),Q.set(n,l);for(var u=0;u<s.length;u++)l.appendChild(Z(s[u],e,t));return l}var p=("object"===("undefined"==typeof global?"undefined":X(global))?global:window).document?document.createElement("div"):null;function $(e){return p&&e&&e.indexOf&&e.includes("&")?(p.innerHTML=e,p.textContent):e}function ee(e){return e.replace(/[&<>]/g,function(e){return"&#"+e.charCodeAt(0)+";"})}var v=new Map,g="diff_perf",m="undefined"!=typeof location,T="undefined"!=typeof process&&process.argv,y=function(){},N=function(r,o){var e=m&&location.search.includes(g),t=T&&process.argv.includes(g);return e||t?function(e){r&&r.host?e=r.host.constructor.name+" "+e:"function"==typeof o.rawNodeName&&(e=o.rawNodeName.name+" "+e);var t=e+"-end";if(v.has(e)){var n=(performance.now()-v.get(e)).toFixed(3);v.delete(e),performance.mark(t),performance.measure("diffHTML "+e+" ("+n+"ms)",e,t)}else v.set(e,performance.now()),performance.mark(e)}:y},E=d.ReleaseHookCache,b=O.memory,w=O.protect,k=O.unprotect;function te(e){w(e);for(var t=0;t<e.childNodes.length;t++)te(e.childNodes[t]);return e}function ne(t){k(t),E.size&&E.forEach(function(e){return e(t)});for(var e=0;e<t.childNodes.length;e++)ne(t.childNodes[e]);return t}function C(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];a.forEach(function(e){return t=t||e.isRendering}),t||(b.allocated.forEach(function(e){return b.free.add(e)}),b.allocated.clear(),Q.forEach(function(e,t){b.protected.has(t)||(Q.delete(t),E.size&&E.forEach(function(e){return e(t)}))}))}var S=Object.freeze({protectVTree:te,unprotectVTree:ne,cleanMemory:C}),R=(0,Object.assign)({decodeEntities:$,escape:ee,makeMeasure:N,memory:S,Pool:O,process:c},t);function H(e){var t=e.state,n=t.isRendering,r=t.activeTransaction,o=t.nextTransaction;if(n){var a=e.tasks,i=o||r;(t.nextTransaction=e).abort();var d=i.promise||Promise.resolve();return e.promise=d.then(function(){return e.aborted=!1,G.flow(e,a.slice(1))})}t.isRendering=!0,t.activeTransaction=e}function A(e){var t=e.domNode,n=e.markup,r=e.state,o=e.state.measure,a=e.options.inner?"innerHTML":"outerHTML";if(o("should update"),"string"==typeof n&&t[a]===n)return e.abort(!0);"string"==typeof n&&(r.markup=n),o("should update")}function I(e){var t=e.state,n=e.domNode,r=e.markup,o=e.options,a=t.previousMarkup,i=o.inner,d=n.outerHTML;if(a===d&&t.oldTree&&d||(t.oldTree&&ne(t.oldTree),t.oldTree=_(n),Q.set(t.oldTree,n),te(t.oldTree)),e.oldTree=t.oldTree,e.newTree||(e.newTree=_(r)),i){var s=e.oldTree,l=e.newTree,u=(s.rawNodeName,s.nodeName),c=s.attributes,f="string"!=typeof l.rawNodeName,h=11===l.nodeType&&!f?l.childNodes:l;e.newTree=_(u,c,h)}}var J=d.SyncTreeHookCache,K={},re=["old","new"];function x(e){var t=e.state.measure,n=e.oldTree,r=e.newTree,o=e.domNode;if(t("sync trees"),n.nodeName!==r.nodeName&&11!==r.nodeType){if(!o.parentNode)throw new Error("Unable to replace top level node without a parent");e.patches={TREE_OPS:[{REPLACE_CHILD:[r,n]}],SET_ATTRIBUTE:[],REMOVE_ATTRIBUTE:[],NODE_VALUE:[]},ne(e.oldTree),e.oldTree=e.state.oldTree=r,te(e.oldTree),a.delete(o),a.set(Z(r),e.state)}else e.patches=function e(n,r,t,o,a){n||(n=K),r||(r=K);n.nodeName,r.nodeType;for(var i=n===K,d={old:new Map,new:new Map},s=0;s<re.length;s++){var l=re[s],u=d[l],c=arguments[s],f=c&&c.childNodes;if(f&&f.length)for(var h=0;h<f.length;h++){var p=f[h];p.key&&u.set(p.key,p)}}var v=!1,g=t=t||{SET_ATTRIBUTE:[],REMOVE_ATTRIBUTE:[],TREE_OPS:[],NODE_VALUE:[]},m=g.SET_ATTRIBUTE,T=g.REMOVE_ATTRIBUTE,y=g.TREE_OPS,N=g.NODE_VALUE,E=(r.nodeName,{INSERT_BEFORE:[],REMOVE_CHILD:[],REPLACE_CHILD:[]});if(J.forEach(function(e){var t=e(n=a||n,r,d,o);t&&t!==r?r=t:t&&t===n&&(v=!0)}),v)return t;var b=E.INSERT_BEFORE,w=E.REMOVE_CHILD,k=E.REPLACE_CHILD,C=1===r.nodeType;if("#text"===r.nodeName)return"#text"!==n.nodeName?N.push(r,r.nodeValue,null):i||n.nodeValue===r.nodeValue||(N.push(n,r.nodeValue,n.nodeValue),n.nodeValue=r.nodeValue),t;if(C){var S=i?K:n.attributes,R=r.attributes;for(var H in R){var O=R[H];H in S&&S[H]===R[H]||(i||(S[H]=O),m.push(i?r:n,H,O))}if(!i)for(var V in S)V in R||(T.push(n,V),delete S[V])}var L=r.childNodes;if(i){for(var M=0;M<L.length;M++)e(null,L[M],t,r);return t}var _=n.childNodes;if(d.old.size||d.new.size){d.old.values();for(var A=0;A<L.length;A++){var I=_[A],x=L[A],D=x.key;if(I){var P=I.key,j=d.new.has(P),U=d.old.has(D);if(j||U)if(j)if(D===P)I.nodeName===x.nodeName?e(I,x,t,r):(k.push(x,I),e(null,n.childNodes[A]=x,t,r));else{var B=x;D&&U?(B=d.old.get(D),_.splice(_.indexOf(B),1)):D&&e(null,B=x,t,r),b.push(n,B,I),_.splice(A,0,B)}else w.push(I),_.splice(_.indexOf(I),1),A-=1;else k.push(x,I),_.splice(_.indexOf(I),1,x),e(null,x,t,r)}else b.push(n,x,null),_.push(x),e(null,x,t,r)}}else for(var z=0;z<L.length;z++){var F=_&&_[z],G=L[z];F?F.nodeName===G.nodeName?e(F,G,t,n):(k.push(G,F),e(null,n.childNodes[z]=G,t,n,n.childNodes[z])):(b.push(n,G,null),_&&_.push(G),e(F,G,t,n))}if(_.length!==L.length){for(var q=L.length;q<_.length;q++)w.push(_[q]);_.length=L.length}return(b.length||w.length||k.length)&&(b.length||(E.INSERT_BEFORE=null),w.length||(E.REMOVE_CHILD=null),k.length||(E.REPLACE_CHILD=null),y.push(E)),t}(n,r);t("sync trees")}var D=["attached","detached","replaced","attributeChanged","textChanged"];function P(e,t){W.get(e).add(t)}function j(e,t){if(!t&&e)W.get(e).clear();else if(e&&t)W.get(e).delete(t);else for(var n=0;n<D.length;n++)W.get(D[n]).clear()}function oe(t){for(var e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var o=W.get(t),a=[];if(!o.size)return a;if("textChanged"!==t&&3===n[0].nodeType)return a;if(o.forEach(function(e){var t=e.apply(void 0,n);"object"===(void 0===t?"undefined":X(t))&&t.then&&a.push(t)}),"attached"===t||"detached"===t){var i=n[0];[].concat(Y(i.childNodes)).forEach(function(e){a.push.apply(a,Y(oe.apply(void 0,[t,e].concat(Y(n.slice(1))))))})}return a}D.forEach(function(e){return W.set(e,new Set)});var ae=new Set(["script","noscript","style","code","template"]),ie=new Set,de=new Set,se=function(e,t){e.removeAttribute(t);var n=e.nodeName+"-"+t;if(de.has(n))e[t]=void 0;else if(!ie.has(n))try{e[t]=void 0,de.add(n)}catch(e){ie.add(n)}};function U(e){var t=e.domNode,n=e.state,r=e.state.measure,o=e.patches,a=e.promises,i=void 0===a?[]:a,d=t.nodeName,s=t.namespaceURI||"";n.isSVG="svg"===d.toLowerCase()||s.includes("svg"),n.ownerDocument=t.ownerDocument||document,r("patch node"),i.push.apply(i,Y(function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},l=[],n=e.TREE_OPS,r=e.NODE_VALUE,o=e.SET_ATTRIBUTE,i=e.REMOVE_ATTRIBUTE,u=t.isSVG,c=t.ownerDocument;if(o.length)for(var a=0;a<o.length;a+=3){var d=o[a],s=o[a+1],f=$(o[a+2]),h=Z(d,c,u),p=oe("attributeChanged",h,s,h.getAttribute(s),f),v="object"===(void 0===f?"undefined":X(f)),g="function"==typeof f,m=0===s.indexOf("on")?s.toLowerCase():s,T=d.nodeName+"-"+m;if(v||g||!m){if(v&&"style"===m)for(var y=Object.keys(f),N=0;N<y.length;N++)h.style[y[N]]=f[y[N]];else if("string"!=typeof f)if(de.has(T))h[m]=f;else if(!ie.has(T))try{h[m]=f,de.add(T)}catch(e){ie.add(T)}}else{var E=null==f;if(de.has(T))h[m]=f;else if(!ie.has(T))try{h[m]=f,de.add(T)}catch(e){ie.add(T)}h.setAttribute(m,E?"":f)}p.length&&l.push.apply(l,Y(p))}if(i.length)for(var b=function(e){var t=i[e],n=i[e+1],r=Q.get(t),o=(W.get("attributeChanged"),r.getAttribute(n)),a=oe("attributeChanged",r,n,o,null);a.length?(Promise.all(a).then(function(){return se(r,n)}),l.push.apply(l,Y(a))):se(r,n)},w=0;w<i.length;w+=2)b(w);for(var k=0;k<n.length;k++){var C=n[k],S=C.INSERT_BEFORE,R=C.REMOVE_CHILD,H=C.REPLACE_CHILD;if(S&&S.length)for(var O=0;O<S.length;O+=3){var V=S[O],L=S[O+1],M=S[O+2],_=Q.get(V),A=M&&Z(M,c,u);W.get("attached"),M&&te(M);var I=Z(L,c,u);te(L),_.insertBefore(I,A);var x=oe("attached",I);l.push.apply(l,Y(x))}if(R&&R.length)for(var D=function(e){var t=R[e],n=Q.get(t),r=(W.get("detached"),oe("detached",n));r.length?(Promise.all(r).then(function(){n.parentNode.removeChild(n),ne(t)}),l.push.apply(l,Y(r))):(n.parentNode.removeChild(n),ne(t))},P=0;P<R.length;P++)D(P);if(H&&H.length)for(var j=function(e){var t=H[e],n=H[e+1],r=Q.get(n),o=Z(t,c,u);W.get("attached"),W.get("detached"),W.get("replaced"),r.parentNode.insertBefore(o,r),te(t);var a=oe("attached",o),i=oe("detached",r),d=oe("replaced",r,o),s=[].concat(Y(a),Y(i),Y(d));s.length?(Promise.all(s).then(function(){r.parentNode.replaceChild(o,r),ne(n)}),l.push.apply(l,Y(s))):(r.parentNode.replaceChild(o,r),ne(n))},U=0;U<H.length;U+=2)j(U)}if(r.length)for(var B=0;B<r.length;B+=3){var z=r[B],F=r[B+1],G=r[B+2],q=Z(z),J=(W.get("textChanged"),oe("textChanged",q,G,F)),K=q.parentNode;F.includes("&")?q.nodeValue=$(F):q.nodeValue=F,K&&ae.has(K.nodeName.toLowerCase())&&(K.nodeValue=ee($(F))),J.length&&l.push.apply(l,Y(J))}return l}(o,n))),r("patch node"),e.promises=i}function B(e){var t=e.promises,n=void 0===t?[]:t;return n.length?e.promise=Promise.all(n).then(function(){return e.end()}):e.promise=Promise.resolve(e.end())}var z=[H,A,I,x,U,B],F={schedule:H,shouldUpdate:A,reconcileTrees:I,syncTrees:x,patchNode:U,endAsPromise:B},G=function(){function r(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.domNode=e,this.markup=t,this.options=n,this.state=a.get(e)||{measure:N(e,t)},this.tasks=[].concat(n.tasks),this.endedCallbacks=new Set,a.set(e,this.state)}return u(r,null,[{key:"create",value:function(e,t,n){return new r(e,t,n)}},{key:"flow",value:function(e,t){for(var n=e,r=0;r<t.length;r++){if(e.aborted)return n;if(void 0!==(n=t[r](e))&&n!==e)return n}}},{key:"assert",value:function(e){}},{key:"invokeMiddleware",value:function(n){var r=n.tasks;d.forEach(function(e){var t=e(n);t&&r.push(t)})}}]),u(r,[{key:"start",value:function(){this.domNode;var e=this.state.measure,t=this.tasks,n=t.pop();return this.aborted=!1,r.invokeMiddleware(this),e("render"),t.push(n),r.flow(this,t)}},{key:"abort",value:function(e){this.state;if(this.aborted=!0,e)return this.tasks[this.tasks.length-1](this)}},{key:"end",value:function(){var t=this,e=this.state,n=this.domNode,r=this.options,o=e.measure;r.inner;return o("finalize"),this.completed=!0,o("finalize"),o("render"),this.endedCallbacks.forEach(function(e){return e(t)}),this.endedCallbacks.clear(),e.previousMarkup=n.outerHTML,e.isRendering=!1,C(),this}},{key:"onceEnded",value:function(e){this.endedCallbacks.add(e)}}]),r}();function q(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return n.inner=!0,n.tasks=n.tasks||z,G.create(e,t,n).start()}function le(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return n.inner=!1,n.tasks=n.tasks||z,G.create(e,t,n).start()}function ue(e){var t=a.get(e);t&&t.oldTree&&ne(t.oldTree),a.delete(e),C()}var ce=d.CreateTreeHookCache,fe=d.CreateNodeHookCache,he=d.SyncTreeHookCache,pe=d.ReleaseHookCache;function ve(e){var t=e.subscribe,n=e.unsubscribe,r=e.createTreeHook,o=e.createNodeHook,a=e.syncTreeHook,i=e.releaseHook;return d.add(e),t&&e.subscribe(),r&&ce.add(r),o&&fe.add(o),a&&he.add(a),i&&pe.add(i),function(){d.delete(e),n&&n(),ce.delete(r),fe.delete(o),he.delete(a),pe.delete(i)}}var ge="1.0.0-beta.9-runtime",me={VERSION:ge,addTransitionState:P,removeTransitionState:j,release:ue,createTree:_,use:ve,outerHTML:le,innerHTML:q,html:_,defaultTasks:z},Te=(0,Object.assign)(R,me,{defaultTasks:z,tasks:F,createNode:Z,syncTree:_});me.Internals=Te,"function"==typeof devTools&&(ve(devTools(Te)),console.warn("diffHTML DevTools: Found and Activated...")),e.VERSION=ge,e.addTransitionState=P,e.removeTransitionState=j,e.release=ue,e.createTree=_,e.use=ve,e.outerHTML=le,e.innerHTML=q,e.html=_,e.Internals=Te,e.default=me,Object.defineProperty(e,"__esModule",{value:!0})});
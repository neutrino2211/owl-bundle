!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.diff=e.diff||{})}(this,function(e){"use strict";var o=new Map,Q=new Map,W=new Map,d=new Set;d.CreateTreeHookCache=new Set,d.CreateNodeHookCache=new Set,d.SyncTreeHookCache=new Set,d.ReleaseHookCache=new Set;for(var t=Object.freeze({StateCache:o,NodeCache:Q,TransitionCache:W,MiddlewareCache:d}),r=new Set,a=new Set,n=new Set,i={free:r,allocated:a,protected:n},s=0;s<1e4;s++)r.add({rawNodeName:"",nodeName:"",nodeValue:"",nodeType:1,key:"",childNodes:[],attributes:{}});var l=r.values(),R={size:1e4,memory:i,get:function(){var e=l.next(),t=e.value,n=void 0===t?{rawNodeName:"",nodeName:"",nodeValue:"",nodeType:1,key:"",childNodes:[],attributes:{}}:t;return e.done&&(l=r.values()),r.delete(n),a.add(n),n},protect:function(e){a.delete(e),n.add(e)},unprotect:function(e){n.has(e)&&(n.delete(e),r.add(e))}},X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),Y=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},O=d.CreateTreeHookCache,I=Array.isArray,H="#document-fragment";function A(e,t,n){for(var r=arguments.length,a=Array(3<r?r-3:0),o=3;o<r;o++)a[o-3]=arguments[o];if(!e)return null;if(I(e)){n=[];for(var i=0;i<e.length;i++){var d=A(e[i]);if(d){var s,l=11===d.nodeType;if("string"==typeof d.rawNodeName&&l)(s=n).push.apply(s,Y(d.childNodes));else n.push(d)}}return A(H,null,n)}var c="object"===(void 0===e?"undefined":X(e));if(e&&c&&"parentNode"in e){if(t={},n=[],3===e.nodeType)n=e.nodeValue;else if(1===e.nodeType&&e.attributes.length){t={};for(var u=0;u<e.attributes.length;u++){var h=e.attributes[u],f=h.name,p=h.value;""===p&&f in e?t[f]=e[f]:t[f]=p}}if((1===e.nodeType||11===e.nodeType)&&e.childNodes.length){n=[];for(var v=0;v<e.childNodes.length;v++)n.push(A(e.childNodes[v]))}var g=A(e.nodeName,t,n);return Q.set(g,e),g}if(c)return!("children"in e)||"childNodes"in e?e:A(e.nodeName||e.elementName,e.attributes,e.children);a.length&&(n=[n].concat(a));var m=R.get(),N="#text"===e,y="string"==typeof e;if(m.key="",m.rawNodeName=e,m.nodeName=y?e.toLowerCase():"#document-fragment",m.childNodes.length=0,m.nodeValue="",m.attributes={},N){var T=2===arguments.length?t:n,b=I(T)?T.join(""):T;return m.nodeType=3,m.nodeValue=String(b||""),m}m.nodeType=e===H||"string"!=typeof e?11:"#comment"===e?8:1;var E=I(t)||"object"!==(void 0===t?"undefined":X(t))?t:n,w=I(E)?E:[E];if(E&&w.length)for(var k=0;k<w.length;k++){var C=w[k];if(I(C))for(var S=0;S<C.length;S++)m.childNodes.push(C[S]);else{if(!C)continue;if(11===C.nodeType&&"string"==typeof C.rawNodeName)for(var _=0;_<C.childNodes.length;_++)m.childNodes.push(C.childNodes[_]);else C&&"object"===(void 0===C?"undefined":X(C))?m.childNodes.push(C):C&&m.childNodes.push(A("#text",null,C))}}t&&"object"===(void 0===t?"undefined":X(t))&&!I(t)&&(m.attributes=t),"script"===m.nodeName&&m.attributes.src&&(m.key=String(m.attributes.src)),m.attributes&&"key"in m.attributes&&(m.key=String(m.attributes.key));var x=m;return O.forEach(function(e,t){(t=e(x))&&(x=t)}),x}var u="undefined"!=typeof process?process:{env:{NODE_ENV:"development"}},h=d.CreateNodeHookCache,f="http://www.w3.org/2000/svg";function Z(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document,t=arguments[2],r=Q.get(n);if(r){if(r.nodeName.toLowerCase()!==n.nodeName)throw new Error("Shit is wrong");return r}var a=n.nodeName,o=n.rawNodeName,i=void 0===o?a:o,d=n.childNodes,s=void 0===d?[]:d;t=t||"svg"===a;var l=null;h.forEach(function(e,t){(t=e(n))&&(l=t)}),l||(l="#text"===a?e.createTextNode(n.nodeValue):"#document-fragment"===a?e.createDocumentFragment():t?e.createElementNS(f,i):e.createElement(i)),Q.set(n,l);for(var c=0;c<s.length;c++)l.appendChild(Z(s[c],e,t));return l}var L=/\S/,M=/<!.*>/i,V=/\b([_a-z][_a-z0-9\-]*)\s*(=\s*("([^"]+)"|'([^']+)'|(\S+)))?/gi,D=/__DIFFHTML__([^_]*)__/,j=/<!--[^]*?(?=-->)-->|<(\/?)([a-z\-\_][a-z0-9\-\_]*)\s*([^>]*?)(\/?)>/gi,T=Object.assign,b=Array.isArray,P=new Set(["script","noscript","style","code","template"]),B=new Set(["meta","img","link","input","area","br","hr","area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]),U={li:{li:!0},p:{p:!0,div:!0},td:{td:!0,th:!0},th:{td:!0,th:!0}},z={li:{ul:!0,ol:!0},a:{div:!0},b:{div:!0},i:{div:!0},p:{div:!0},td:{tr:!0,table:!0},th:{tr:!0,table:!0}},F=function(e,t){var n,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(t&&!M.test(t)&&!D.test(t))return e.childNodes.push(A("#text",t));for(var a=[],o=t.split(D),i=(o.length,0);i<o.length;i++){var d=o[i];if(d)if(i%2==1){var s=r.children[d];if(!s)continue;var l=11===s.nodeType;"string"==typeof s.rawNodeName&&l?a.push.apply(a,Y(s.childNodes)):a.push(s)}else M.test(d)||a.push(A("#text",d))}(n=e.childNodes).push.apply(n,a)},G=function e(t,n,r,a){var o;if(o=D.exec(t))return e(r.tags[o[1]],n,r,a);for(var i,d={};i=V.exec(n||"");){var s=i[1],l=i[6]||i[5]||i[4]||i[1],c=l.match(D);if(c&&c.length)for(var u=l.split(D),h=(u.length,D.exec(s)),f=h?r.attributes[h[1]]:s,p=0;p<u.length;p++){var v=u[p];if(v)if(p%2==1)if(d[f])d[f]+=r.attributes[v];else{var g="object"===(void 0===f?"undefined":X(f));g&&!b(f)&&f?T(d,f):g&&a.strict||f&&"object"!==(void 0===f?"undefined":X(f))&&(d[f]=r.attributes[v])}else d[f]?d[f]+=v:d[f]=v}else if(c=D.exec(s)){var m=r.attributes[c[1]],N=D.exec(l),y=N?r.attributes[N[1]]:l;d[m]='""'===l?"":y}else d[s]='""'===l?"":l}return A(t,d,[])};function p(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=A("#document-fragment",null,[]),a=[r],o=r,i=-1;if(!e.includes("<")&&e)return F(o,e,t),r;for(var d,s,l=0;d=j.exec(e);l++){-1<i&&i+d[0].length<j.lastIndex&&(s=e.slice(i,j.lastIndex-d[0].length))&&F(o,s,t);var c=j.lastIndex-d[0].length;if(-1===i&&0<c){var u=e.slice(0,c);u&&L.test(u)&&!M.exec(u)&&F(o,u,t)}if(i=j.lastIndex,"!"!==d[0][1]){if(!d[1]){if(!d[4]&&U[o.rawNodeName]&&U[o.rawNodeName][d[2]]&&(a.pop(),o=a[a.length-1]),o=o.childNodes[o.childNodes.push(G(d[2],d[3],t,n))-1],a.push(o),n.strict||P.has(d[2])){var h="</"+d[2]+">",f=e.indexOf(h,j.lastIndex);d[2].length;-1===f?i=j.lastIndex=e.length+1:(i=f+h.length,j.lastIndex=i,d[1]=!0);var p=e.slice(d.index+d[0].length,f);F(o,p,t)}}if(d[1]||d[4]||B.has(d[2]))for(var v=D.exec(d[2]);o;){if("/"===d[4]&&v){a.pop(),o=a[a.length-1];break}if(v){var g=t.tags[v[1]];if(o.rawNodeName===g){a.pop(),o=a[a.length-1];break}}if(o.rawNodeName===d[2]){a.pop(),o=a[a.length-1];break}var m=z[o.rawNodeName];if(!m||!m[d[2]])break;a.pop(),o=a[a.length-1]}}}var N=e.slice(-1===i?0:i).trim();if(N&&F(o,N,t),r.childNodes.length&&"html"===r.childNodes[0].nodeName){var y={before:[],after:[]},T={after:[]},b=r.childNodes[0],E=!0,w=!0;if(b.childNodes=b.childNodes.filter(function(e){if("body"===e.nodeName||"head"===e.nodeName)return"head"===e.nodeName&&(E=!1),"body"===e.nodeName&&(w=!1),!0;1===e.nodeType&&(E&&w?y.before.push(e):!E&&w?y.after.push(e):w||T.after.push(e))}),b.childNodes[0]&&"head"===b.childNodes[0].nodeName){var k=b.childNodes[0].childNodes;k.unshift.apply(k,y.before),k.push.apply(k,y.after)}else{var C=A("head",null,[]),S=C.childNodes;S.unshift.apply(S,y.before),S.push.apply(S,y.after),b.childNodes.unshift(C)}if(b.childNodes[1]&&"body"===b.childNodes[1].nodeName){var _=b.childNodes[1].childNodes;_.push.apply(_,T.after)}else{var x=A("body",null,[]),R=x.childNodes;R.push.apply(R,T.after),b.childNodes.push(x)}}return V.lastIndex=0,j.lastIndex=0,r}var v=d.ReleaseHookCache,g=R.memory,m=R.protect,N=R.unprotect;function $(e){m(e);for(var t=0;t<e.childNodes.length;t++)$(e.childNodes[t]);return e}function ee(t){N(t),v.size&&v.forEach(function(e){return e(t)});for(var e=0;e<t.childNodes.length;e++)ee(t.childNodes[e]);return t}function y(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];o.forEach(function(e){return t=t||e.isRendering}),t||(g.allocated.forEach(function(e){return g.free.add(e)}),g.allocated.clear(),Q.forEach(function(e,t){g.protected.has(t)||(Q.delete(t),v.size&&v.forEach(function(e){return e(t)}))}))}var E=Object.freeze({protectVTree:$,unprotectVTree:ee,cleanMemory:y});function w(e){var t=e.state,n=e.domNode,r=e.markup,a=e.options,o=t.previousMarkup,i=a.inner,d=n.outerHTML;if(o===d&&t.oldTree&&d||(t.oldTree&&ee(t.oldTree),t.oldTree=A(n),Q.set(t.oldTree,n),$(t.oldTree)),e.oldTree=t.oldTree,e.newTree||(e.newTree=A(r)),i){var s=e.oldTree,l=e.newTree,c=(s.rawNodeName,s.nodeName),u=s.attributes,h="string"!=typeof l.rawNodeName,f=11===l.nodeType&&!h?l.childNodes:l;e.newTree=A(c,u,f)}}var k=("object"===("undefined"==typeof global?"undefined":X(global))?global:window).document?document.createElement("div"):null;function te(e){return k&&e&&e.indexOf&&e.includes("&")?(k.innerHTML=e,k.textContent):e}function ne(e){return e.replace(/[&<>]/g,function(e){return"&#"+e.charCodeAt(0)+";"})}var C=new Map,S="diff_perf",_="undefined"!=typeof location,x="undefined"!=typeof process&&process.argv,q=function(){},J=function(r,a){var e=_&&location.search.includes(S),t=x&&process.argv.includes(S);return e||t?function(e){r&&r.host?e=r.host.constructor.name+" "+e:"function"==typeof a.rawNodeName&&(e=a.rawNodeName.name+" "+e);var t=e+"-end";if(C.has(e)){var n=(performance.now()-C.get(e)).toFixed(3);C.delete(e),performance.mark(t),performance.measure("diffHTML "+e+" ("+n+"ms)",e,t)}else C.set(e,performance.now()),performance.mark(e)}:q},K=(0,Object.assign)({decodeEntities:te,escape:ne,makeMeasure:J,memory:E,Pool:R,process:u},t);function re(e){var t=e.state,n=t.isRendering,r=t.activeTransaction,a=t.nextTransaction;if(n){var o=e.tasks,i=a||r;(t.nextTransaction=e).abort();var d=i.promise||Promise.resolve();return e.promise=d.then(function(){return e.aborted=!1,be.flow(e,o.slice(1))})}t.isRendering=!0,t.activeTransaction=e}function ae(e){var t=e.domNode,n=e.markup,r=e.state,a=e.state.measure,o=e.options.inner?"innerHTML":"outerHTML";if(a("should update"),"string"==typeof n&&t[o]===n)return e.abort(!0);"string"==typeof n&&(r.markup=n),a("should update")}var oe=d.SyncTreeHookCache,ie={},de=["old","new"];function se(e){var t=e.state.measure,n=e.oldTree,r=e.newTree,a=e.domNode;if(t("sync trees"),n.nodeName!==r.nodeName&&11!==r.nodeType){if(!a.parentNode)throw new Error("Unable to replace top level node without a parent");e.patches={TREE_OPS:[{REPLACE_CHILD:[r,n]}],SET_ATTRIBUTE:[],REMOVE_ATTRIBUTE:[],NODE_VALUE:[]},ee(e.oldTree),e.oldTree=e.state.oldTree=r,$(e.oldTree),o.delete(a),o.set(Z(r),e.state)}else e.patches=function e(n,r,t,a,o){n||(n=ie),r||(r=ie);n.nodeName,r.nodeType;for(var i=n===ie,d={old:new Map,new:new Map},s=0;s<de.length;s++){var l=de[s],c=d[l],u=arguments[s],h=u&&u.childNodes;if(h&&h.length)for(var f=0;f<h.length;f++){var p=h[f];p.key&&c.set(p.key,p)}}var v=!1,g=t=t||{SET_ATTRIBUTE:[],REMOVE_ATTRIBUTE:[],TREE_OPS:[],NODE_VALUE:[]},m=g.SET_ATTRIBUTE,N=g.REMOVE_ATTRIBUTE,y=g.TREE_OPS,T=g.NODE_VALUE,b=(r.nodeName,{INSERT_BEFORE:[],REMOVE_CHILD:[],REPLACE_CHILD:[]});if(oe.forEach(function(e){var t=e(n=o||n,r,d,a);t&&t!==r?r=t:t&&t===n&&(v=!0)}),v)return t;var E=b.INSERT_BEFORE,w=b.REMOVE_CHILD,k=b.REPLACE_CHILD,C=1===r.nodeType;if("#text"===r.nodeName)return"#text"!==n.nodeName?T.push(r,r.nodeValue,null):i||n.nodeValue===r.nodeValue||(T.push(n,r.nodeValue,n.nodeValue),n.nodeValue=r.nodeValue),t;if(C){var S=i?ie:n.attributes,_=r.attributes;for(var x in _){var R=_[x];x in S&&S[x]===_[x]||(i||(S[x]=R),m.push(i?r:n,x,R))}if(!i)for(var O in S)O in _||(N.push(n,O),delete S[O])}var I=r.childNodes;if(i){for(var H=0;H<I.length;H++)e(null,I[H],t,r);return t}var A=n.childNodes;if(d.old.size||d.new.size){d.old.values();for(var L=0;L<I.length;L++){var M=A[L],V=I[L],D=V.key;if(M){var j=M.key,P=d.new.has(j),B=d.old.has(D);if(P||B)if(P)if(D===j)M.nodeName===V.nodeName?e(M,V,t,r):(k.push(V,M),e(null,n.childNodes[L]=V,t,r));else{var U=V;D&&B?(U=d.old.get(D),A.splice(A.indexOf(U),1)):D&&e(null,U=V,t,r),E.push(n,U,M),A.splice(L,0,U)}else w.push(M),A.splice(A.indexOf(M),1),L-=1;else k.push(V,M),A.splice(A.indexOf(M),1,V),e(null,V,t,r)}else E.push(n,V,null),A.push(V),e(null,V,t,r)}}else for(var z=0;z<I.length;z++){var F=A&&A[z],G=I[z];F?F.nodeName===G.nodeName?e(F,G,t,n):(k.push(G,F),e(null,n.childNodes[z]=G,t,n,n.childNodes[z])):(E.push(n,G,null),A&&A.push(G),e(F,G,t,n))}if(A.length!==I.length){for(var q=I.length;q<A.length;q++)w.push(A[q]);A.length=I.length}return(E.length||w.length||k.length)&&(E.length||(b.INSERT_BEFORE=null),w.length||(b.REMOVE_CHILD=null),k.length||(b.REPLACE_CHILD=null),y.push(b)),t}(n,r);t("sync trees")}var le=["attached","detached","replaced","attributeChanged","textChanged"];function ce(e,t){W.get(e).add(t)}function ue(e,t){if(!t&&e)W.get(e).clear();else if(e&&t)W.get(e).delete(t);else for(var n=0;n<le.length;n++)W.get(le[n]).clear()}function he(t){for(var e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var a=W.get(t),o=[];if(!a.size)return o;if("textChanged"!==t&&3===n[0].nodeType)return o;if(a.forEach(function(e){var t=e.apply(void 0,n);"object"===(void 0===t?"undefined":X(t))&&t.then&&o.push(t)}),"attached"===t||"detached"===t){var i=n[0];[].concat(Y(i.childNodes)).forEach(function(e){o.push.apply(o,Y(he.apply(void 0,[t,e].concat(Y(n.slice(1))))))})}return o}le.forEach(function(e){return W.set(e,new Set)});var fe=new Set(["script","noscript","style","code","template"]),pe=new Set,ve=new Set,ge=function(e,t){e.removeAttribute(t);var n=e.nodeName+"-"+t;if(ve.has(n))e[t]=void 0;else if(!pe.has(n))try{e[t]=void 0,ve.add(n)}catch(e){pe.add(n)}};function me(e){var t=e.domNode,n=e.state,r=e.state.measure,a=e.patches,o=e.promises,i=void 0===o?[]:o,d=t.nodeName,s=t.namespaceURI||"";n.isSVG="svg"===d.toLowerCase()||s.includes("svg"),n.ownerDocument=t.ownerDocument||document,r("patch node"),i.push.apply(i,Y(function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},l=[],n=e.TREE_OPS,r=e.NODE_VALUE,a=e.SET_ATTRIBUTE,i=e.REMOVE_ATTRIBUTE,c=t.isSVG,u=t.ownerDocument;if(a.length)for(var o=0;o<a.length;o+=3){var d=a[o],s=a[o+1],h=te(a[o+2]),f=Z(d,u,c),p=he("attributeChanged",f,s,f.getAttribute(s),h),v="object"===(void 0===h?"undefined":X(h)),g="function"==typeof h,m=0===s.indexOf("on")?s.toLowerCase():s,N=d.nodeName+"-"+m;if(v||g||!m){if(v&&"style"===m)for(var y=Object.keys(h),T=0;T<y.length;T++)f.style[y[T]]=h[y[T]];else if("string"!=typeof h)if(ve.has(N))f[m]=h;else if(!pe.has(N))try{f[m]=h,ve.add(N)}catch(e){pe.add(N)}}else{var b=null==h;if(ve.has(N))f[m]=h;else if(!pe.has(N))try{f[m]=h,ve.add(N)}catch(e){pe.add(N)}f.setAttribute(m,b?"":h)}p.length&&l.push.apply(l,Y(p))}if(i.length)for(var E=function(e){var t=i[e],n=i[e+1],r=Q.get(t),a=(W.get("attributeChanged"),r.getAttribute(n)),o=he("attributeChanged",r,n,a,null);o.length?(Promise.all(o).then(function(){return ge(r,n)}),l.push.apply(l,Y(o))):ge(r,n)},w=0;w<i.length;w+=2)E(w);for(var k=0;k<n.length;k++){var C=n[k],S=C.INSERT_BEFORE,_=C.REMOVE_CHILD,x=C.REPLACE_CHILD;if(S&&S.length)for(var R=0;R<S.length;R+=3){var O=S[R],I=S[R+1],H=S[R+2],A=Q.get(O),L=H&&Z(H,u,c);W.get("attached"),H&&$(H);var M=Z(I,u,c);$(I),A.insertBefore(M,L);var V=he("attached",M);l.push.apply(l,Y(V))}if(_&&_.length)for(var D=function(e){var t=_[e],n=Q.get(t),r=(W.get("detached"),he("detached",n));r.length?(Promise.all(r).then(function(){n.parentNode.removeChild(n),ee(t)}),l.push.apply(l,Y(r))):(n.parentNode.removeChild(n),ee(t))},j=0;j<_.length;j++)D(j);if(x&&x.length)for(var P=function(e){var t=x[e],n=x[e+1],r=Q.get(n),a=Z(t,u,c);W.get("attached"),W.get("detached"),W.get("replaced"),r.parentNode.insertBefore(a,r),$(t);var o=he("attached",a),i=he("detached",r),d=he("replaced",r,a),s=[].concat(Y(o),Y(i),Y(d));s.length?(Promise.all(s).then(function(){r.parentNode.replaceChild(a,r),ee(n)}),l.push.apply(l,Y(s))):(r.parentNode.replaceChild(a,r),ee(n))},B=0;B<x.length;B+=2)P(B)}if(r.length)for(var U=0;U<r.length;U+=3){var z=r[U],F=r[U+1],G=r[U+2],q=Z(z),J=(W.get("textChanged"),he("textChanged",q,G,F)),K=q.parentNode;F.includes("&")?q.nodeValue=te(F):q.nodeValue=F,K&&fe.has(K.nodeName.toLowerCase())&&(K.nodeValue=ne(te(F))),J.length&&l.push.apply(l,Y(J))}return l}(a,n))),r("patch node"),e.promises=i}function Ne(e){var t=e.promises,n=void 0===t?[]:t;return n.length?e.promise=Promise.all(n).then(function(){return e.end()}):e.promise=Promise.resolve(e.end())}var ye=[re,ae,w,se,me,Ne],Te={schedule:re,shouldUpdate:ae,reconcileTrees:w,syncTrees:se,patchNode:me,endAsPromise:Ne},be=function(){function r(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.domNode=e,this.markup=t,this.options=n,this.state=o.get(e)||{measure:J(e,t)},this.tasks=[].concat(n.tasks),this.endedCallbacks=new Set,o.set(e,this.state)}return c(r,null,[{key:"create",value:function(e,t,n){return new r(e,t,n)}},{key:"flow",value:function(e,t){for(var n=e,r=0;r<t.length;r++){if(e.aborted)return n;if(void 0!==(n=t[r](e))&&n!==e)return n}}},{key:"assert",value:function(e){}},{key:"invokeMiddleware",value:function(n){var r=n.tasks;d.forEach(function(e){var t=e(n);t&&r.push(t)})}}]),c(r,[{key:"start",value:function(){this.domNode;var e=this.state.measure,t=this.tasks,n=t.pop();return this.aborted=!1,r.invokeMiddleware(this),e("render"),t.push(n),r.flow(this,t)}},{key:"abort",value:function(e){this.state;if(this.aborted=!0,e)return this.tasks[this.tasks.length-1](this)}},{key:"end",value:function(){var t=this,e=this.state,n=this.domNode,r=this.options,a=e.measure;r.inner;return a("finalize"),this.completed=!0,a("finalize"),a("render"),this.endedCallbacks.forEach(function(e){return e(t)}),this.endedCallbacks.clear(),e.previousMarkup=n.outerHTML,e.isRendering=!1,y(),this}},{key:"onceEnded",value:function(e){this.endedCallbacks.add(e)}}]),r}();function Ee(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return n.inner=!0,n.tasks=n.tasks||ye,be.create(e,t,n).start()}function we(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return n.inner=!1,n.tasks=n.tasks||ye,be.create(e,t,n).start()}var ke=Array.isArray,Ce=/(<|\/)/,Se="__DIFFHTML__",_e=function(e){var t=e.shift();return"string"==typeof t?ne(te(t)):t};function xe(e){for(var t=arguments.length,c=Array(1<t?t-1:0),n=1;n<t;n++)c[n-1]=arguments[n];if("string"==typeof e&&(e=[e]),!e)return null;if(1===e.length&&!c.length){var r=xe.isStrict;xe.isStrict=void 0;var a=p(e[0],null,{strict:r}).childNodes;return 1<a.length?A(a):a[0]}var u="",h={attributes:{},children:{},tags:{}};e.forEach(function(e,t){if(u+=e,c.length){var n=_e(c),r=(e.split(" ").pop(),u.trim().slice(-1)),a=u.lastIndexOf(">")<u.lastIndexOf("<"),o=Boolean(r.match(Ce)),i="string"==typeof n,d="object"===(void 0===n?"undefined":X(n)),s=ke(n),l=""+Se+t+"__";o&&!i?(h.tags[t]=n,u+=l):a?(h.attributes[t]=n,u+=l):s||d?(h.children[t]=A(n),u+=l):n&&(u+=n)}});var o=xe.isStrict;xe.isStrict=void 0;var i=p(u,h,{strict:o}).childNodes;return 1===i.length?i[0]:A(i)}function Re(e){var t=o.get(e);t&&t.oldTree&&ee(t.oldTree),o.delete(e),y()}xe.strict=function(){return xe.isStrict=!0,xe.apply(void 0,arguments)};var Oe=d.CreateTreeHookCache,Ie=d.CreateNodeHookCache,He=d.SyncTreeHookCache,Ae=d.ReleaseHookCache;function Le(e){var t=e.subscribe,n=e.unsubscribe,r=e.createTreeHook,a=e.createNodeHook,o=e.syncTreeHook,i=e.releaseHook;return d.add(e),t&&e.subscribe(),r&&Oe.add(r),a&&Ie.add(a),o&&He.add(o),i&&Ae.add(i),function(){d.delete(e),n&&n(),Oe.delete(r),Ie.delete(a),He.delete(o),Ae.delete(i)}}var Me="1.0.0-beta.9";ye.splice(ye.indexOf(w),0,function(e){var t=e.state,n=e.markup,r=e.options,a=t.measure,o=r.inner;if("string"==typeof n){a("parsing markup for new tree");var i=p(n,null,r).childNodes;e.newTree=A(o?i:i[0]||i),a("parsing markup for new tree")}});var Ve={VERSION:Me,addTransitionState:ce,removeTransitionState:ue,release:Re,createTree:A,use:Le,outerHTML:we,innerHTML:Ee,html:xe},De=(0,Object.assign)(K,Ve,{parse:p,defaultTasks:ye,tasks:Te,createNode:Z,syncTree:A});Ve.Internals=De,"undefined"!=typeof devTools&&(Le(devTools(De)),console.warn("diffHTML DevTools: Found and Activated...")),e.VERSION=Me,e.addTransitionState=ce,e.removeTransitionState=ue,e.release=Re,e.createTree=A,e.use=Le,e.outerHTML=we,e.innerHTML=Ee,e.html=xe,e.Internals=De,e.default=Ve,Object.defineProperty(e,"__esModule",{value:!0})});
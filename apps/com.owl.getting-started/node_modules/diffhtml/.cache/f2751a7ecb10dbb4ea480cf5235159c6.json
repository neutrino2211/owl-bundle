{"id":"WcQp","dependencies":[{"name":"/home/tbranyen/git/diffhtml/packages/diffhtml/package.json","includedInParent":true,"mtime":1534977442154},{"name":"/home/tbranyen/git/diffhtml/packages/diffhtml/.babelrc","includedInParent":true,"mtime":1534634600429},{"name":"../tree/sync","loc":{"line":1,"column":21},"parent":"/home/tbranyen/git/diffhtml/packages/diffhtml/lib/tasks/sync-trees.js","resolved":"/home/tbranyen/git/diffhtml/packages/diffhtml/lib/tree/sync.js"},{"name":"../node/create","loc":{"line":2,"column":23},"parent":"/home/tbranyen/git/diffhtml/packages/diffhtml/lib/tasks/sync-trees.js","resolved":"/home/tbranyen/git/diffhtml/packages/diffhtml/lib/node/create.js"},{"name":"../util/caches","loc":{"line":3,"column":27},"parent":"/home/tbranyen/git/diffhtml/packages/diffhtml/lib/tasks/sync-trees.js","resolved":"/home/tbranyen/git/diffhtml/packages/diffhtml/lib/util/caches.js"},{"name":"../util/memory","loc":{"line":4,"column":45},"parent":"/home/tbranyen/git/diffhtml/packages/diffhtml/lib/tasks/sync-trees.js","resolved":"/home/tbranyen/git/diffhtml/packages/diffhtml/lib/util/memory.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.default=n;var e=require(\"../tree/sync\"),t=l(e),r=require(\"../node/create\"),o=l(r),a=require(\"../util/caches\"),d=require(\"../util/memory\");function l(e){return e&&e.__esModule?e:{default:e}}function n(e){var r=e.state.measure,l=e.oldTree,n=e.newTree,s=e.domNode;if(r(\"sync trees\"),l.nodeName!==n.nodeName&&11!==n.nodeType){if(!s.parentNode)throw new Error(\"Unable to replace top level node without a parent\");e.patches={TREE_OPS:[{REPLACE_CHILD:[n,l]}],SET_ATTRIBUTE:[],REMOVE_ATTRIBUTE:[],NODE_VALUE:[]},(0,d.unprotectVTree)(e.oldTree),e.oldTree=e.state.oldTree=n,(0,d.protectVTree)(e.oldTree),a.StateCache.delete(s),a.StateCache.set((0,o.default)(n),e.state)}else e.patches=(0,t.default)(l,n);r(\"sync trees\")}","map":{"mappings":[{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":0}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":13}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":20}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":35}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":43}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":56}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":57}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":64}},{"source":"tasks/sync-trees.js","name":"syncTrees","original":{"line":6,"column":24},"generated":{"line":1,"column":68}},{"source":"tasks/sync-trees.js","name":"syncTrees","original":{"line":6,"column":24},"generated":{"line":1,"column":76}},{"source":"tasks/sync-trees.js","name":"syncTrees","original":{"line":6,"column":24},"generated":{"line":1,"column":84}},{"source":"tasks/sync-trees.js","original":{"line":1,"column":0},"generated":{"line":1,"column":86}},{"source":"tasks/sync-trees.js","original":{"line":1,"column":0},"generated":{"line":1,"column":90}},{"source":"tasks/sync-trees.js","original":{"line":1,"column":0},"generated":{"line":1,"column":92}},{"source":"tasks/sync-trees.js","original":{"line":1,"column":0},"generated":{"line":1,"column":100}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":116}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":118}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":120}},{"source":"tasks/sync-trees.js","original":{"line":2,"column":0},"generated":{"line":1,"column":123}},{"source":"tasks/sync-trees.js","original":{"line":2,"column":0},"generated":{"line":1,"column":125}},{"source":"tasks/sync-trees.js","original":{"line":2,"column":0},"generated":{"line":1,"column":133}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":151}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":153}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":155}},{"source":"tasks/sync-trees.js","original":{"line":3,"column":0},"generated":{"line":1,"column":158}},{"source":"tasks/sync-trees.js","original":{"line":3,"column":0},"generated":{"line":1,"column":160}},{"source":"tasks/sync-trees.js","original":{"line":3,"column":0},"generated":{"line":1,"column":168}},{"source":"tasks/sync-trees.js","original":{"line":4,"column":0},"generated":{"line":1,"column":186}},{"source":"tasks/sync-trees.js","original":{"line":4,"column":0},"generated":{"line":1,"column":188}},{"source":"tasks/sync-trees.js","original":{"line":4,"column":0},"generated":{"line":1,"column":196}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":214}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":223}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":225}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":228}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":235}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":238}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":240}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":251}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":253}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":254}},{"source":"tasks/sync-trees.js","original":{"line":42,"column":1},"generated":{"line":1,"column":262}},{"source":"tasks/sync-trees.js","original":{"line":6,"column":15},"generated":{"line":1,"column":265}},{"source":"tasks/sync-trees.js","name":"syncTrees","original":{"line":6,"column":24},"generated":{"line":1,"column":274}},{"source":"tasks/sync-trees.js","name":"transaction","original":{"line":6,"column":34},"generated":{"line":1,"column":276}},{"source":"tasks/sync-trees.js","name":"measure","original":{"line":7,"column":19},"generated":{"line":1,"column":279}},{"source":"tasks/sync-trees.js","name":"measure","original":{"line":7,"column":19},"generated":{"line":1,"column":283}},{"source":"tasks/sync-trees.js","name":"transaction","original":{"line":7,"column":60},"generated":{"line":1,"column":285}},{"source":"tasks/sync-trees.js","name":"state","original":{"line":7,"column":10},"generated":{"line":1,"column":287}},{"source":"tasks/sync-trees.js","name":"measure","original":{"line":7,"column":19},"generated":{"line":1,"column":293}},{"source":"tasks/sync-trees.js","name":"oldTree","original":{"line":7,"column":30},"generated":{"line":1,"column":301}},{"source":"tasks/sync-trees.js","name":"transaction","original":{"line":7,"column":60},"generated":{"line":1,"column":303}},{"source":"tasks/sync-trees.js","name":"oldTree","original":{"line":7,"column":30},"generated":{"line":1,"column":305}},{"source":"tasks/sync-trees.js","name":"newTree","original":{"line":7,"column":39},"generated":{"line":1,"column":313}},{"source":"tasks/sync-trees.js","name":"transaction","original":{"line":7,"column":60},"generated":{"line":1,"column":315}},{"source":"tasks/sync-trees.js","name":"newTree","original":{"line":7,"column":39},"generated":{"line":1,"column":317}},{"source":"tasks/sync-trees.js","name":"domNode","original":{"line":7,"column":48},"generated":{"line":1,"column":325}},{"source":"tasks/sync-trees.js","name":"transaction","original":{"line":7,"column":60},"generated":{"line":1,"column":327}},{"source":"tasks/sync-trees.js","name":"domNode","original":{"line":7,"column":48},"generated":{"line":1,"column":329}},{"source":"tasks/sync-trees.js","name":"oldTree","original":{"line":14,"column":6},"generated":{"line":1,"column":337}},{"source":"tasks/sync-trees.js","original":{"line":9,"column":10},"generated":{"line":1,"column":340}},{"source":"tasks/sync-trees.js","original":{"line":9,"column":10},"generated":{"line":1,"column":342}},{"source":"tasks/sync-trees.js","name":"oldTree","original":{"line":14,"column":6},"generated":{"line":1,"column":356}},{"source":"tasks/sync-trees.js","name":"nodeName","original":{"line":14,"column":14},"generated":{"line":1,"column":358}},{"source":"tasks/sync-trees.js","name":"newTree","original":{"line":14,"column":27},"generated":{"line":1,"column":369}},{"source":"tasks/sync-trees.js","name":"nodeName","original":{"line":14,"column":35},"generated":{"line":1,"column":371}},{"source":"tasks/sync-trees.js","original":{"line":14,"column":68},"generated":{"line":1,"column":381}},{"source":"tasks/sync-trees.js","name":"newTree","original":{"line":14,"column":47},"generated":{"line":1,"column":386}},{"source":"tasks/sync-trees.js","name":"nodeType","original":{"line":14,"column":55},"generated":{"line":1,"column":388}},{"source":"tasks/sync-trees.js","original":{"line":14,"column":72},"generated":{"line":1,"column":397}},{"source":"tasks/sync-trees.js","original":{"line":17,"column":8},"generated":{"line":1,"column":398}},{"source":"tasks/sync-trees.js","name":"domNode","original":{"line":17,"column":9},"generated":{"line":1,"column":402}},{"source":"tasks/sync-trees.js","name":"parentNode","original":{"line":17,"column":17},"generated":{"line":1,"column":404}},{"source":"tasks/sync-trees.js","original":{"line":18,"column":12},"generated":{"line":1,"column":415}},{"source":"tasks/sync-trees.js","original":{"line":18,"column":12},"generated":{"line":1,"column":421}},{"source":"tasks/sync-trees.js","name":"Error","original":{"line":18,"column":16},"generated":{"line":1,"column":425}},{"source":"tasks/sync-trees.js","original":{"line":18,"column":22},"generated":{"line":1,"column":431}},{"source":"tasks/sync-trees.js","name":"patches","original":{"line":21,"column":16},"generated":{"line":1,"column":484}},{"source":"tasks/sync-trees.js","name":"patches","original":{"line":21,"column":16},"generated":{"line":1,"column":486}},{"source":"tasks/sync-trees.js","original":{"line":21,"column":26},"generated":{"line":1,"column":494}},{"source":"tasks/sync-trees.js","original":{"line":22,"column":16},"generated":{"line":1,"column":495}},{"source":"tasks/sync-trees.js","original":{"line":22,"column":16},"generated":{"line":1,"column":504}},{"source":"tasks/sync-trees.js","original":{"line":22,"column":17},"generated":{"line":1,"column":505}},{"source":"tasks/sync-trees.js","name":"REPLACE_CHILD","original":{"line":22,"column":19},"generated":{"line":1,"column":506}},{"source":"tasks/sync-trees.js","original":{"line":22,"column":34},"generated":{"line":1,"column":520}},{"source":"tasks/sync-trees.js","name":"newTree","original":{"line":22,"column":35},"generated":{"line":1,"column":521}},{"source":"tasks/sync-trees.js","name":"oldTree","original":{"line":22,"column":44},"generated":{"line":1,"column":523}},{"source":"tasks/sync-trees.js","original":{"line":23,"column":21},"generated":{"line":1,"column":528}},{"source":"tasks/sync-trees.js","original":{"line":23,"column":21},"generated":{"line":1,"column":542}},{"source":"tasks/sync-trees.js","original":{"line":24,"column":24},"generated":{"line":1,"column":545}},{"source":"tasks/sync-trees.js","original":{"line":24,"column":24},"generated":{"line":1,"column":562}},{"source":"tasks/sync-trees.js","original":{"line":25,"column":18},"generated":{"line":1,"column":565}},{"source":"tasks/sync-trees.js","original":{"line":25,"column":18},"generated":{"line":1,"column":576}},{"source":"tasks/sync-trees.js","name":"transaction","original":{"line":28,"column":19},"generated":{"line":1,"column":581}},{"source":"tasks/sync-trees.js","name":"transaction","original":{"line":28,"column":19},"generated":{"line":1,"column":583}},{"source":"tasks/sync-trees.js","name":"transaction","original":{"line":28,"column":19},"generated":{"line":1,"column":585}},{"source":"tasks/sync-trees.js","name":"transaction","original":{"line":28,"column":19},"generated":{"line":1,"column":601}},{"source":"tasks/sync-trees.js","name":"oldTree","original":{"line":28,"column":31},"generated":{"line":1,"column":603}},{"source":"tasks/sync-trees.js","name":"oldTree","original":{"line":29,"column":16},"generated":{"line":1,"column":612}},{"source":"tasks/sync-trees.js","name":"oldTree","original":{"line":29,"column":16},"generated":{"line":1,"column":614}},{"source":"tasks/sync-trees.js","name":"transaction","original":{"line":29,"column":26},"generated":{"line":1,"column":622}},{"source":"tasks/sync-trees.js","name":"state","original":{"line":29,"column":38},"generated":{"line":1,"column":624}},{"source":"tasks/sync-trees.js","name":"oldTree","original":{"line":29,"column":44},"generated":{"line":1,"column":630}},{"source":"tasks/sync-trees.js","name":"newTree","original":{"line":29,"column":54},"generated":{"line":1,"column":638}},{"source":"tasks/sync-trees.js","name":"transaction","original":{"line":30,"column":17},"generated":{"line":1,"column":641}},{"source":"tasks/sync-trees.js","name":"transaction","original":{"line":30,"column":17},"generated":{"line":1,"column":643}},{"source":"tasks/sync-trees.js","name":"transaction","original":{"line":30,"column":17},"generated":{"line":1,"column":645}},{"source":"tasks/sync-trees.js","name":"transaction","original":{"line":30,"column":17},"generated":{"line":1,"column":659}},{"source":"tasks/sync-trees.js","name":"oldTree","original":{"line":30,"column":29},"generated":{"line":1,"column":661}},{"source":"tasks/sync-trees.js","name":"delete","original":{"line":33,"column":15},"generated":{"line":1,"column":670}},{"source":"tasks/sync-trees.js","name":"delete","original":{"line":33,"column":15},"generated":{"line":1,"column":672}},{"source":"tasks/sync-trees.js","name":"delete","original":{"line":33,"column":15},"generated":{"line":1,"column":683}},{"source":"tasks/sync-trees.js","name":"domNode","original":{"line":33,"column":22},"generated":{"line":1,"column":690}},{"source":"tasks/sync-trees.js","name":"set","original":{"line":34,"column":15},"generated":{"line":1,"column":693}},{"source":"tasks/sync-trees.js","name":"set","original":{"line":34,"column":15},"generated":{"line":1,"column":695}},{"source":"tasks/sync-trees.js","name":"set","original":{"line":34,"column":15},"generated":{"line":1,"column":706}},{"source":"tasks/sync-trees.js","original":{"line":34,"column":19},"generated":{"line":1,"column":711}},{"source":"tasks/sync-trees.js","name":"newTree","original":{"line":34,"column":30},"generated":{"line":1,"column":713}},{"source":"tasks/sync-trees.js","name":"newTree","original":{"line":34,"column":30},"generated":{"line":1,"column":715}},{"source":"tasks/sync-trees.js","name":"newTree","original":{"line":34,"column":30},"generated":{"line":1,"column":724}},{"source":"tasks/sync-trees.js","name":"transaction","original":{"line":34,"column":40},"generated":{"line":1,"column":727}},{"source":"tasks/sync-trees.js","name":"state","original":{"line":34,"column":52},"generated":{"line":1,"column":729}},{"source":"tasks/sync-trees.js","name":"patches","original":{"line":38,"column":16},"generated":{"line":1,"column":741}},{"source":"tasks/sync-trees.js","name":"patches","original":{"line":38,"column":16},"generated":{"line":1,"column":743}},{"source":"tasks/sync-trees.js","original":{"line":38,"column":26},"generated":{"line":1,"column":752}},{"source":"tasks/sync-trees.js","name":"oldTree","original":{"line":38,"column":35},"generated":{"line":1,"column":754}},{"source":"tasks/sync-trees.js","name":"oldTree","original":{"line":38,"column":35},"generated":{"line":1,"column":756}},{"source":"tasks/sync-trees.js","name":"oldTree","original":{"line":38,"column":35},"generated":{"line":1,"column":765}},{"source":"tasks/sync-trees.js","name":"newTree","original":{"line":38,"column":44},"generated":{"line":1,"column":767}},{"source":"tasks/sync-trees.js","original":{"line":41,"column":10},"generated":{"line":1,"column":770}},{"source":"tasks/sync-trees.js","original":{"line":41,"column":10},"generated":{"line":1,"column":772}}],"sources":{"tasks/sync-trees.js":"import syncTree from '../tree/sync';\nimport createNode from '../node/create';\nimport { StateCache } from '../util/caches';\nimport { protectVTree, unprotectVTree } from '../util/memory';\n\nexport default function syncTrees(transaction) {\n  const { state: { measure }, oldTree, newTree, domNode } = transaction;\n\n  measure('sync trees');\n\n  // Do a global replace of the element, unable to do this at a lower level.\n  // Ignore this for document fragments, they don't appear in the DOM and we\n  // treat them as transparent containers.\n  if (oldTree.nodeName !== newTree.nodeName && newTree.nodeType !== 11) {\n    // If there is no `parentNode` for the replace operation, we will need to\n    // throw an error and prevent the `StateCache` from being updated.\n    if (!domNode.parentNode) {\n      throw new Error('Unable to replace top level node without a parent');\n    }\n\n    transaction.patches = {\n      TREE_OPS: [{ REPLACE_CHILD: [newTree, oldTree] }],\n      SET_ATTRIBUTE: [],\n      REMOVE_ATTRIBUTE: [],\n      NODE_VALUE: [],\n    };\n\n    unprotectVTree(transaction.oldTree);\n    transaction.oldTree = transaction.state.oldTree = newTree;\n    protectVTree(transaction.oldTree);\n\n    // Update the StateCache since we are changing the top level element.\n    StateCache.delete(domNode);\n    StateCache.set(createNode(newTree), transaction.state);\n  }\n  // Otherwise only diff the children.\n  else {\n    transaction.patches = syncTree(oldTree, newTree);\n  }\n\n  measure('sync trees');\n}\n"},"lineCount":null}},"hash":"a65b4f2d20c1364aa4b3902cfcb54c72","cacheData":{"env":{}}}